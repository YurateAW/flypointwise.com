<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flight Deal Optimizer</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 p-8">
  <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg">
    <h1 class="text-2xl font-bold mb-4">Flight Deal Optimizer ‚úàÔ∏è</h1>

    <form id="searchForm" class="space-y-3">
      <input id="from" type="text" placeholder="From (e.g. HAM)" class="border p-2 w-full rounded">
      <input id="to" type="text" placeholder="To (e.g. TYO)" class="border p-2 w-full rounded">
      <input id="departure" type="date" class="border p-2 w-full rounded">
      <input id="return" type="date" class="border p-2 w-full rounded">
      <input id="passengers" type="number" min="1" value="1" class="border p-2 w-full rounded">
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Search</button>
    </form>

    <div id="results" class="mt-6"></div>
  </div>

  <script>
  document.getElementById('searchForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const query = {
      from: document.getElementById('from').value,
      to: document.getElementById('to').value,
      departure: document.getElementById('departure').value,
      return: document.getElementById('return').value,
      passengers: document.getElementById('passengers').value
    };

    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = '<p>üîç Searching best deals...</p>';

    try {
      const response = await fetch('https://flypointwise-backend-production.railway.app/api/flight-agent', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(query)
      });

      if (!response.ok) throw new Error(`Server error: ${response.status}`);

      const data = await response.json();
      const results = data.results || [];

      if (!Array.isArray(results) || results.length === 0) {
        resultsDiv.innerHTML = '<p>No results found. Try changing your search.</p>';
        return; // ‚úÖ safely inside function
      }

      const html = results.map(r => `
        <div class="border rounded-lg p-4 mb-4 shadow-sm bg-gray-100">
          <h2 class="text-xl font-semibold mb-1">${r.rank}. ${r.airline} ‚Äî ${r.class || 'Economy'}</h2>
          <p class="text-gray-700 mb-1">${r.route}</p>
          <p class="text-sm text-gray-500">Type: ${r.type}</p>
          <p><strong>Total Cost:</strong> ${r.total_cost}</p>
          ${r.estimated_savings ? `<p><strong>Savings:</strong> ${r.estimated_savings}</p>` : ''}
          ${r.transfer_info ? `<p><strong>Transfer:</strong> ${r.transfer_info}</p>` : ''}
          ${r.booking_link ? `<a href="${r.booking_link}" target="_blank" class="text-blue-600 underline mt-2 inline-block">Book Now</a>` : ''}
        </div>
      `).join('');

      resultsDiv.innerHTML = html;

    } catch (error) {
      console.error(error);
      resultsDiv.innerHTML = `<p class="text-red-600">Error: ${error.message}</p>`;
    }
  });
  </script>
</body>
</html>
